<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>rdrc</title>
    <style media="screen">
      #dot {
        /* TODO vmin fallback */
        width: 80vmin;
        height: 80vmin;
        background: #fff;
        border-radius: 100%;
        display: inline-block;

        position: absolute;
        top:50%;
        left:50%;
        margin-top:-40vmin;
        margin-left:-40vmin;

        box-shadow: #000 0 0 40px;

        /* todo - prefix */
        transition: 2s;
      }

      #dot.cover {
        /* todo - prefix */
        transform: scale(4.5,4)
      }
      #dot.won {
        background: red;
      }

      body {
        background: #3e3c3c
      }

    </style>
  </head>
  <body>
    <div id="dot" class="cover"></div>

    <script src="bower_components/es6-promise/es6-promise.js"></script>
    <script src="bower_components/fetch/fetch.js"></script>
    <script src="bower_components/pusher/dist/web/pusher.js"></script>
    <script type="text/javascript">
      setTimeout(function(){
        dot.className = ''
      },100)

      var pusher, channel;

      fetch('/config')
        .then(function(res){return res.json()})
        .then(function(config){
          pusher = new Pusher(config.key, {
            cluster: config.cluster,
            encrypted: true
          })

          channel = pusher.subscribe('presence-competition')
          channel.bind('winner', function(data) {
            // alert(data.name + " won")
            console.log(data)

            if(data.user.id == channel.members.myID) {
              // alert("WIN")

              dot.className = 'won'

              setTimeout(function(){
                dot.className = ''
              },2000)
            }
          });

        })
    </script>
  </body>
</html>
